<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ceramic Coating Calculator - Spectrum Outfitters</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .calculator-section { background-color: #f9fafb; padding: 1.5rem; border-radius: 0.5rem; }
        .results-section { background-color: #eff6ff; padding: 1.5rem; border-radius: 0.5rem; }
        .price-display { background-color: #dcfce7; padding: 1rem; border-radius: 0.5rem; text-align: center; }
        .floor-price { background-color: #fef2f2; border: 1px solid #fecaca; padding: 0.75rem; border-radius: 0.5rem; }
        .cost-breakdown { background-color: white; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 0.5rem; }
        .correction-info { background-color: #f0f9ff; border: 1px solid #bae6fd; padding: 0.75rem; border-radius: 0.5rem; }
        .settings-popup { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5); 
            display: none; 
            z-index: 1000;
        }
        .settings-content { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: white; 
            padding: 2rem; 
            border-radius: 1rem; 
            max-width: 500px; 
            width: 90%;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="max-w-6xl mx-auto p-6">
        <!-- Header with Settings Button -->
        <div class="flex justify-between items-center mb-8">
            <div class="text-center flex-1">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">üíé Ceramic Coating Calculator</h1>
                <p class="text-gray-600">Professional Ceramic Coating Pricing Tool</p>
            </div>
            <button id="settingsBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                ‚öôÔ∏è Settings
            </button>
        </div>

        <div class="grid lg:grid-cols-3 gap-6">
            <!-- Vehicle & Paint Condition -->
            <div class="calculator-section">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    üöó Vehicle & Paint Condition
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Type</label>
                        <select id="vehicleType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="car">Car/Sedan</option>
                            <option value="coupe">Coupe/Sports Car</option>
                            <option value="truck">Truck/Pickup</option>
                            <option value="suv">SUV/Large Vehicle</option>
                            <option value="van">Van/Commercial</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Paint Condition</label>
                        <select id="paintCondition" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="excellent">Excellent (No correction needed)</option>
                            <option value="good">Good (1-stage correction)</option>
                            <option value="fair">Fair (2-stage correction)</option>
                            <option value="poor">Poor (3-stage correction)</option>
                            <option value="very-poor">Very Poor (4-stage correction)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Surface Type</label>
                        <select id="surfaceType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="paint">Bare Paint</option>
                            <option value="ppf">PPF Film</option>
                            <option value="wrap">Vinyl Wrap</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Coating Package</label>
                        <div class="flex gap-2">
                            <button id="threeYearBtn" class="flex-1 px-3 py-2 text-sm rounded bg-blue-600 text-white">3-Year</button>
                            <button id="fiveYearBtn" class="flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300">5-Year</button>
                            <button id="sevenYearBtn" class="flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300">7-9 Year</button>
                        </div>
                    </div>

                    <!-- Time Estimates Display -->
                    <div class="correction-info" id="timeEstimates">
                        <div class="text-sm font-medium text-blue-800 mb-1" id="totalTimeLabel">Total Estimated Time</div>
                        <div class="text-xs text-blue-600" id="timeBreakdown">0 hours total</div>
                        <div class="text-xs text-blue-600 mt-1">Bottle Usage: <span id="bottleUsage">0 bottles</span></div>
                    </div>
                </div>
            </div>

            <!-- Labor & Pricing -->
            <div class="calculator-section">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    üí∞ Labor & Pricing
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Labor Type</label>
                        <div class="flex gap-2">
                            <button id="contractedBtn" class="flex-1 px-3 py-2 text-sm rounded bg-blue-600 text-white">Contracted</button>
                            <button id="hourlyBtn" class="flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300">Hourly</button>
                        </div>
                    </div>

                    <div id="contractedInput">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Contracted Cost</label>
                        <input type="number" id="contractedCost" value="800" min="0" step="50" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Total contracted labor cost</p>
                    </div>

                    <div id="hourlyInput" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Hourly Rate</label>
                        <input type="number" id="hourlyRate" value="75" min="0" step="5" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Per hour labor rate</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Customer Type</label>
                        <div class="flex gap-2">
                            <button id="customerBtn" class="flex-1 px-3 py-2 text-sm rounded bg-green-600 text-white">Customer</button>
                            <button id="dealerBtn" class="flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300">Dealer (-15%)</button>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tax %</label>
                        <input type="number" id="taxPct" value="0" min="0" max="15" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Local tax rate</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Deposit %</label>
                        <input type="number" id="depositPct" value="50" min="0" max="100" step="5" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Required deposit percentage</p>
                    </div>
                </div>
            </div>

            <!-- Results & Quote -->
            <div class="results-section">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    üìä Results & Quote
                </h2>

                <div class="space-y-4">
                    <div class="price-display">
                        <div class="text-sm text-gray-600 mb-1">Customer Price</div>
                        <div class="text-3xl font-bold text-green-600" id="finalPrice">$0</div>
                        <div class="text-sm text-gray-600" id="marginDisplay">0.0% margin</div>
                    </div>

                    <div class="floor-price">
                        <div class="text-sm font-medium text-red-800 mb-1">Floor Price (Do Not Go Below)</div>
                        <div class="text-sm text-red-600">30% minimum margin required</div>
                        <div class="text-lg font-semibold text-red-800" id="floorPrice">$0</div>
                    </div>

                    <div class="cost-breakdown">
                        <h3 class="font-medium text-gray-800 mb-2">Cost Breakdown</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Paint Correction:</span>
                                <span id="correctionCost">$0</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Coating Materials:</span>
                                <span id="coatingMaterialsCost">$0</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Labor:</span>
                                <span id="laborCost">$0</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Prep Materials:</span>
                                <span id="prepCost">$0</span>
                            </div>
                            <div class="border-t pt-1 font-medium">
                                <div class="flex justify-between">
                                    <span>Total Cost:</span>
                                    <span id="totalCost">$0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-3 rounded border">
                        <div class="text-sm space-y-1">
                            <div class="flex justify-between">
                                <span>Subtotal:</span>
                                <span id="subtotal">$0</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Tax (<span id="taxDisplay">0%</span>):</span>
                                <span id="taxAmount">$0</span>
                            </div>
                            <div class="flex justify-between font-medium">
                                <span>Total with Tax:</span>
                                <span id="totalWithTax">$0</span>
                            </div>
                            <div class="flex justify-between text-blue-600">
                                <span>Deposit (<span id="depositDisplay">50%</span>):</span>
                                <span id="depositAmount">$0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Paint Correction Guide -->
        <div class="mt-8 grid md:grid-cols-2 lg:grid-cols-5 gap-4">
            <div class="bg-white p-4 rounded border">
                <div class="font-medium text-green-800 mb-2">Excellent</div>
                <div class="text-gray-600 mb-1">No correction needed</div>
                <div class="text-gray-500">0 hours, $0 materials</div>
            </div>
            <div class="bg-white p-4 rounded border">
                <div class="font-medium text-blue-800 mb-2">Good</div>
                <div class="text-gray-600 mb-1">1-stage correction</div>
                <div class="text-gray-500">2-3 hours, $25 materials</div>
            </div>
            <div class="bg-white p-4 rounded border">
                <div class="font-medium text-yellow-800 mb-2">Fair</div>
                <div class="text-gray-600 mb-1">2-stage correction</div>
                <div class="text-gray-500">4-6 hours, $50 materials</div>
            </div>
            <div class="bg-white p-4 rounded border">
                <div class="font-medium text-orange-800 mb-2">Poor</div>
                <div class="text-gray-600 mb-1">3-stage correction</div>
                <div class="text-gray-500">6-8 hours, $75 materials</div>
            </div>
            <div class="bg-white p-4 rounded border">
                <div class="font-medium text-red-800 mb-2">Very Poor</div>
                <div class="text-gray-600 mb-1">4-stage correction</div>
                <div class="text-gray-500">8-12 hours, $100 materials</div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mt-8 text-center space-x-4">
            <button id="copyBtn" class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                üìã Copy Quote
            </button>
            <button id="resetBtn" class="px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                üîÑ Reset
            </button>
        </div>

        <!-- Back to Tools Button -->
        <div class="mt-8 text-center">
            <a href="/" class="inline-flex items-center gap-2 px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                <span>üîß</span>
                <span>Back to All Tools</span>
            </a>
        </div>

        <!-- Footer -->
        <div class="mt-12 border-t border-gray-200 pt-8">
            <div class="text-center">
                <div class="flex items-center justify-center gap-3 mb-4">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                        <span class="text-white font-bold text-sm">S</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800">Spectrum Outfitters</h3>
                </div>
                <p class="text-gray-600 mb-2">Professional Ceramic Coating Services</p>
                <div class="text-sm text-gray-500 space-y-1">
                    <p>Ceramic Coating ‚Ä¢ Paint Correction ‚Ä¢ Vehicle Protection</p>
                    <p class="font-medium text-blue-600">spectrumoutfitters.com</p>
                </div>
                <div class="mt-4 text-xs text-gray-400">
                    <p>¬© 2025 Spectrum Outfitters. All rights reserved.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Popup -->
    <div id="settingsPopup" class="settings-popup">
        <div class="settings-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Ceramic Coating Settings</h3>
                <button id="closeSettings" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <h4 class="font-medium text-gray-800 mb-2">Coating Package Pricing</h4>
                    <div class="grid grid-cols-1 gap-3">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">3-Year Coating - Bottle Cost</label>
                            <input type="number" id="bottle3Year" value="85" min="0" step="5" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">5-Year Coating - Bottle Cost</label>
                            <input type="number" id="bottle5Year" value="120" min="0" step="5" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">7-9 Year Coating - Bottle Cost</label>
                            <input type="number" id="bottle7Year" value="180" min="0" step="5" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="font-medium text-gray-800 mb-2">Vehicle Bottle Usage (ml per vehicle)</h4>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div>
                            <label class="block text-gray-600 mb-1">Car/Sedan</label>
                            <input type="number" id="usageCar" value="15" min="5" step="1" class="w-full px-2 py-1 border border-gray-300 rounded">
                        </div>
                        <div>
                            <label class="block text-gray-600 mb-1">Coupe/Sports</label>
                            <input type="number" id="usageCoupe" value="18" min="5" step="1" class="w-full px-2 py-1 border border-gray-300 rounded">
                        </div>
                        <div>
                            <label class="block text-gray-600 mb-1">Truck/Pickup</label>
                            <input type="number" id="usageTruck" value="25" min="5" step="1" class="w-full px-2 py-1 border border-gray-300 rounded">
                        </div>
                        <div>
                            <label class="block text-gray-600 mb-1">SUV/Large</label>
                            <input type="number" id="usageSuv" value="28" min="5" step="1" class="w-full px-2 py-1 border border-gray-300 rounded">
                        </div>
                        <div>
                            <label class="block text-gray-600 mb-1">Van/Commercial</label>
                            <input type="number" id="usageVan" value="32" min="5" step="1" class="w-full px-2 py-1 border border-gray-300 rounded">
                        </div>
                        <div>
                            <label class="block text-gray-600 mb-1">Custom</label>
                            <input type="number" id="usageCustom" value="20" min="5" step="1" class="w-full px-2 py-1 border border-gray-300 rounded">
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="font-medium text-gray-800 mb-2">Bottle Sizes (ml)</h4>
                    <div class="grid grid-cols-3 gap-3">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">3-Year</label>
                            <input type="number" id="size3Year" value="50" min="10" step="5" class="w-full px-2 py-1 border border-gray-300 rounded">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">5-Year</label>
                            <input type="number" id="size5Year" value="50" min="10" step="5" class="w-full px-2 py-1 border border-gray-300 rounded">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">7-9 Year</label>
                            <input type="number" id="size7Year" value="50" min="10" step="5" class="w-full px-2 py-1 border border-gray-300 rounded">
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 flex justify-end space-x-3">
                <button id="saveSettings" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save Settings</button>
                <button id="cancelSettings" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Constants
        const BASELINE_MARGIN = 0.30;
        const RETAIL_MARKUP = 0.30;
        const DEALER_DISCOUNT = 0.15;

        // Vehicle time estimates (base coating time + correction time)
        const vehicleTimeEstimates = {
            car: { baseTime: 4, label: 'Car/Sedan' },
            coupe: { baseTime: 4.5, label: 'Coupe/Sports Car' },
            truck: { baseTime: 6, label: 'Truck/Pickup' },
            suv: { baseTime: 6.5, label: 'SUV/Large Vehicle' },
            van: { baseTime: 7, label: 'Van/Commercial' },
            custom: { baseTime: 5, label: 'Custom' }
        };

        // Paint correction estimates
        const correctionEstimates = {
            'excellent': { hours: 0, materials: 0, label: 'No Correction Needed' },
            'good': { hours: 2.5, materials: 25, label: '1-Stage Correction' },
            'fair': { hours: 5, materials: 50, label: '2-Stage Correction' },
            'poor': { hours: 7, materials: 75, label: '3-Stage Correction' },
            'very-poor': { hours: 10, materials: 100, label: '4-Stage Correction' }
        };

        // Surface type adjustments
        const surfaceAdjustments = {
            'paint': { prepMultiplier: 1.0, coatingMultiplier: 1.0 },
            'ppf': { prepMultiplier: 0.8, coatingMultiplier: 1.2 },
            'wrap': { prepMultiplier: 0.6, coatingMultiplier: 1.3 }
        };

        // Default settings (industry standard)
        let settings = {
            bottle3Year: 85,
            bottle5Year: 120,
            bottle7Year: 180,
            usageCar: 15,
            usageCoupe: 18,
            usageTruck: 25,
            usageSuv: 28,
            usageVan: 32,
            usageCustom: 20,
            size3Year: 50,
            size5Year: 50,
            size7Year: 50
        };

        // State
        let currentState = {
            vehicleType: 'car',
            paintCondition: 'excellent',
            surfaceType: 'paint',
            coatingType: 'three-year',
            laborType: 'contracted',
            customerType: 'customer'
        };

        // Utility functions
        function usd(n) {
            if (n === undefined || n === null || isNaN(n)) return '$0';
            return n.toLocaleString(undefined, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
        }

        function pct(f) {
            if (!isFinite(f)) return '0.0%';
            return `${(f * 100).toFixed(1)}%`;
        }

        // Update time estimates display
        function updateTimeEstimates() {
            const vehicleType = currentState.vehicleType;
            const paintCondition = currentState.paintCondition;
            const surfaceType = currentState.surfaceType;
            
            const vehicleEst = vehicleTimeEstimates[vehicleType];
            const correctionEst = correctionEstimates[paintCondition];
            const surfaceAdj = surfaceAdjustments[surfaceType];
            
            const baseTime = vehicleEst.baseTime;
            const correctionTime = correctionEst.hours * surfaceAdj.prepMultiplier;
            const totalTime = baseTime + correctionTime;
            
            // Calculate bottle usage
            const usageKey = `usage${vehicleType.charAt(0).toUpperCase() + vehicleType.slice(1)}`;
            const usagePerCar = settings[usageKey];
            const bottleSize = settings[`size${currentState.coatingType.split('-')[0]}Year`];
            const bottlesPerCar = usagePerCar / bottleSize;
            
            document.getElementById('totalTimeLabel').textContent = 'Total Estimated Time';
            document.getElementById('timeBreakdown').textContent = `${totalTime.toFixed(1)} hours total (${baseTime}h coating + ${correctionTime.toFixed(1)}h correction)`;
            document.getElementById('bottleUsage').textContent = `${bottlesPerCar.toFixed(1)} bottles`;
        }

        // Calculate results
        function calculateResults() {
            const vehicleType = currentState.vehicleType;
            const paintCondition = currentState.paintCondition;
            const surfaceType = currentState.surfaceType;
            const coatingType = currentState.coatingType;
            const laborType = currentState.laborType;
            const customerType = currentState.customerType;
            
            const taxPct = parseFloat(document.getElementById('taxPct').value) || 0;
            const depositPct = parseFloat(document.getElementById('depositPct').value) || 50;

            // Get estimates
            const vehicleEst = vehicleTimeEstimates[vehicleType];
            const correctionEst = correctionEstimates[paintCondition];
            const surfaceAdj = surfaceAdjustments[surfaceType];

            // Calculate costs
            const correctionHours = correctionEst.hours * surfaceAdj.prepMultiplier;
            const correctionMaterials = correctionEst.materials * surfaceAdj.prepMultiplier;
            const correctionCost = correctionHours * 75; // $75/hour for correction

            // Calculate coating materials cost
            const usageKey = `usage${vehicleType.charAt(0).toUpperCase() + vehicleType.slice(1)}`;
            const usagePerCar = settings[usageKey];
            const bottleSize = settings[`size${coatingType.split('-')[0]}Year`];
            const bottlesPerCar = usagePerCar / bottleSize;
            const bottleCost = settings[`bottle${coatingType.split('-')[0]}Year`];
            const coatingMaterialsCost = bottleCost * bottlesPerCar;

            // Calculate coating labor cost (based on time)
            const baseTime = vehicleEst.baseTime;
            const coatingLaborCost = baseTime * 75; // $75/hour for coating

            const prepCost = correctionMaterials + (correctionHours * 15); // $15/hour for prep materials

            let laborCost = 0;
            if (laborType === 'contracted') {
                laborCost = parseFloat(document.getElementById('contractedCost').value) || 0;
            } else {
                const hourlyRate = parseFloat(document.getElementById('hourlyRate').value) || 75;
                const hoursNeeded = parseFloat(document.getElementById('hoursNeeded').value) || 8;
                laborCost = hourlyRate * hoursNeeded;
            }

            const totalCost = correctionCost + coatingMaterialsCost + coatingLaborCost + laborCost + prepCost;

            // Calculate pricing with 30% minimum margin
            const minPrice = totalCost / (1 - BASELINE_MARGIN);
            const retailPrice = minPrice * (1 + RETAIL_MARKUP);
            const finalPrice = customerType === 'dealer' ? retailPrice * (1 - DEALER_DISCOUNT) : retailPrice;

            // Calculate margin
            const margin = (finalPrice - totalCost) / finalPrice;

            // Calculate tax and deposit
            const taxAmount = finalPrice * (taxPct / 100);
            const totalWithTax = finalPrice + taxAmount;
            const depositAmount = totalWithTax * (depositPct / 100);

            // Update displays
            document.getElementById('correctionCost').textContent = usd(correctionCost);
            document.getElementById('coatingMaterialsCost').textContent = usd(coatingMaterialsCost);
            document.getElementById('coatingLaborCost').textContent = usd(coatingLaborCost);
            document.getElementById('laborCost').textContent = usd(laborCost);
            document.getElementById('prepCost').textContent = usd(prepCost);
            document.getElementById('totalCost').textContent = usd(totalCost);
            document.getElementById('subtotal').textContent = usd(finalPrice);
            document.getElementById('taxDisplay').textContent = pct(taxPct / 100);
            document.getElementById('taxAmount').textContent = usd(taxAmount);
            document.getElementById('totalWithTax').textContent = usd(totalWithTax);
            document.getElementById('depositDisplay').textContent = pct(depositPct / 100);
            document.getElementById('depositAmount').textContent = usd(depositAmount);
            document.getElementById('finalPrice').textContent = usd(finalPrice);
            document.getElementById('marginDisplay').textContent = pct(margin);
            document.getElementById('floorPrice').textContent = usd(minPrice);
        }

        // Settings popup functions
        function openSettings() {
            document.getElementById('settingsPopup').style.display = 'block';
            loadSettingsToForm();
        }

        function closeSettings() {
            document.getElementById('settingsPopup').style.display = 'none';
        }

        function loadSettingsToForm() {
            document.getElementById('bottle3Year').value = settings.bottle3Year;
            document.getElementById('bottle5Year').value = settings.bottle5Year;
            document.getElementById('bottle7Year').value = settings.bottle7Year;
            document.getElementById('usageCar').value = settings.usageCar;
            document.getElementById('usageCoupe').value = settings.usageCoupe;
            document.getElementById('usageTruck').value = settings.usageTruck;
            document.getElementById('usageSuv').value = settings.usageSuv;
            document.getElementById('usageVan').value = settings.usageVan;
            document.getElementById('usageCustom').value = settings.usageCustom;
            document.getElementById('size3Year').value = settings.size3Year;
            document.getElementById('size5Year').value = settings.size5Year;
            document.getElementById('size7Year').value = settings.size7Year;
        }

        function saveSettings() {
            settings.bottle3Year = parseFloat(document.getElementById('bottle3Year').value) || 85;
            settings.bottle5Year = parseFloat(document.getElementById('bottle5Year').value) || 120;
            settings.bottle7Year = parseFloat(document.getElementById('bottle7Year').value) || 180;
            settings.usageCar = parseFloat(document.getElementById('usageCar').value) || 15;
            settings.usageCoupe = parseFloat(document.getElementById('usageCoupe').value) || 18;
            settings.usageTruck = parseFloat(document.getElementById('usageTruck').value) || 25;
            settings.usageSuv = parseFloat(document.getElementById('usageSuv').value) || 28;
            settings.usageVan = parseFloat(document.getElementById('usageVan').value) || 32;
            settings.usageCustom = parseFloat(document.getElementById('usageCustom').value) || 20;
            settings.size3Year = parseFloat(document.getElementById('size3Year').value) || 50;
            settings.size5Year = parseFloat(document.getElementById('size5Year').value) || 50;
            settings.size7Year = parseFloat(document.getElementById('size7Year').value) || 50;
            
            closeSettings();
            updateTimeEstimates();
            calculateResults();
        }

        // Setup event handlers
        function setupEventHandlers() {
            // Settings button
            document.getElementById('settingsBtn').addEventListener('click', openSettings);
            document.getElementById('closeSettings').addEventListener('click', closeSettings);
            document.getElementById('saveSettings').addEventListener('click', saveSettings);
            document.getElementById('cancelSettings').addEventListener('click', closeSettings);

            // Vehicle type change
            document.getElementById('vehicleType').addEventListener('change', function() {
                currentState.vehicleType = this.value;
                updateTimeEstimates();
                calculateResults();
            });

            // Paint condition change
            document.getElementById('paintCondition').addEventListener('change', function() {
                currentState.paintCondition = this.value;
                updateTimeEstimates();
                calculateResults();
            });

            // Surface type change
            document.getElementById('surfaceType').addEventListener('change', function() {
                currentState.surfaceType = this.value;
                updateTimeEstimates();
                calculateResults();
            });

            // Coating type buttons
            document.getElementById('threeYearBtn').addEventListener('click', function() {
                currentState.coatingType = 'three-year';
                document.getElementById('threeYearBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-blue-600 text-white';
                document.getElementById('fiveYearBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                document.getElementById('sevenYearBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                updateTimeEstimates();
                calculateResults();
            });

            document.getElementById('fiveYearBtn').addEventListener('click', function() {
                currentState.coatingType = 'five-year';
                document.getElementById('fiveYearBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-blue-600 text-white';
                document.getElementById('threeYearBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                document.getElementById('sevenYearBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                updateTimeEstimates();
                calculateResults();
            });

            document.getElementById('sevenYearBtn').addEventListener('click', function() {
                currentState.coatingType = 'seven-year';
                document.getElementById('sevenYearBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-blue-600 text-white';
                document.getElementById('threeYearBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                document.getElementById('fiveYearBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                updateTimeEstimates();
                calculateResults();
            });

            // Labor type buttons
            document.getElementById('contractedBtn').addEventListener('click', function() {
                currentState.laborType = 'contracted';
                document.getElementById('contractedBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-blue-600 text-white';
                document.getElementById('hourlyBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                document.getElementById('contractedInput').classList.remove('hidden');
                document.getElementById('hourlyInput').classList.add('hidden');
                calculateResults();
            });

            document.getElementById('hourlyBtn').addEventListener('click', function() {
                currentState.laborType = 'hourly';
                document.getElementById('hourlyBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-blue-600 text-white';
                document.getElementById('contractedBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                document.getElementById('hourlyInput').classList.remove('hidden');
                document.getElementById('contractedInput').classList.add('hidden');
                calculateResults();
            });

            // Customer type buttons
            document.getElementById('customerBtn').addEventListener('click', function() {
                currentState.customerType = 'customer';
                document.getElementById('customerBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-green-600 text-white';
                document.getElementById('dealerBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                calculateResults();
            });

            document.getElementById('dealerBtn').addEventListener('click', function() {
                currentState.customerType = 'dealer';
                document.getElementById('dealerBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-green-600 text-white';
                document.getElementById('customerBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                calculateResults();
            });

            // Input changes
            const inputs = ['contractedCost', 'hourlyRate', 'taxPct', 'depositPct'];
            inputs.forEach(id => {
                document.getElementById(id).addEventListener('input', calculateResults);
            });

            // Copy button
            document.getElementById('copyBtn').addEventListener('click', async function() {
                const quote = generateQuote();
                try {
                    await navigator.clipboard.writeText(quote);
                    alert('Quote copied to clipboard!');
                } catch {
                    const ta = document.createElement('textarea');
                    ta.value = quote;
                    document.body.appendChild(ta);
                    ta.select();
                    document.execCommand('copy');
                    document.body.removeChild(ta);
                    alert('Quote copied to clipboard!');
                }
            });

            // Reset button
            document.getElementById('resetBtn').addEventListener('click', function() {
                document.getElementById('vehicleType').value = 'car';
                document.getElementById('paintCondition').value = 'excellent';
                document.getElementById('surfaceType').value = 'paint';
                document.getElementById('contractedCost').value = 800;
                document.getElementById('hourlyRate').value = 75;
                document.getElementById('taxPct').value = 0;
                document.getElementById('depositPct').value = 50;
                
                // Reset buttons
                currentState = {
                    vehicleType: 'car',
                    paintCondition: 'excellent',
                    surfaceType: 'paint',
                    coatingType: 'three-year',
                    laborType: 'contracted',
                    customerType: 'customer'
                };
                
                // Reset button styles
                document.getElementById('threeYearBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-blue-600 text-white';
                document.getElementById('fiveYearBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                document.getElementById('sevenYearBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                document.getElementById('contractedBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-blue-600 text-white';
                document.getElementById('hourlyBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                document.getElementById('customerBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-green-600 text-white';
                document.getElementById('dealerBtn').className = 'flex-1 px-3 py-2 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300';
                
                document.getElementById('contractedInput').classList.remove('hidden');
                document.getElementById('hourlyInput').classList.add('hidden');
                
                updateTimeEstimates();
                calculateResults();
            });
        }

        // Generate quote
        function generateQuote() {
            const vehicleType = document.getElementById('vehicleType');
            const paintCondition = document.getElementById('paintCondition');
            const surfaceType = document.getElementById('surfaceType');
            const vehicleLabel = vehicleType.options[vehicleType.selectedIndex].text;
            const paintLabel = paintCondition.options[paintCondition.selectedIndex].text;
            const surfaceLabel = surfaceType.options[surfaceType.selectedIndex].text;
            
            const coatingLabels = {
                'three-year': '3-Year Coating',
                'five-year': '5-Year Coating',
                'seven-year': '7-9 Year Coating'
            };
            
            return `Spectrum Outfitters ‚Äî Ceramic Coating Quote
--------------------------------
Vehicle: ${vehicleLabel}
Paint Condition: ${paintLabel}
Surface: ${surfaceLabel}
Coating: ${coatingLabels[currentState.coatingType]}
Customer Type: ${currentState.customerType === 'dealer' ? 'Dealer (15% off retail)' : 'Retail'}

Costs
  Paint Correction: ${document.getElementById('correctionCost').textContent}
  Coating Materials: ${document.getElementById('coatingMaterialsCost').textContent}
  Coating Labor: ${document.getElementById('coatingLaborCost').textContent}
  Labor: ${document.getElementById('laborCost').textContent}
  Prep Materials: ${document.getElementById('prepCost').textContent}
  Total Cost: ${document.getElementById('totalCost').textContent}

Quoted
  Final Price: ${document.getElementById('finalPrice').textContent}
  Margin: ${document.getElementById('marginDisplay').textContent}

---
spectrumoutfitters.com
Professional Ceramic Coating Services`;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventHandlers();
            updateTimeEstimates();
            calculateResults();
        });
    </script>
</body>
</html>
